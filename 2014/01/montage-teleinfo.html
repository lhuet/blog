<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Java dans le hard(ware) - Montage teleinfo pour Raspberry Pi / BeagleBone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
    <!-- link href="/blog/css/bootstrap-theme.min.css" rel="stylesheet" -->
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">
	
      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Java dans le hard(ware)</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li><a href="/blog/index.html">Home</a></li>
              <li><a href="/blog/about.html">A propos</a></li>
              <li><a href="/blog/feed.xml">Flux RSS</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
      <div class="container">
	
	<div class="page-header">
		<h1>Montage teleinfo pour Raspberry Pi / BeagleBone</h1>
	</div>

	<p><em>19 janvier 2014</em></p>
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/01/montage-teleinfo.html" data-via="lhuet35" data-text="Montage teleinfo pour Raspberry Pi / BeagleBone" data-lang="fr">Tweeter</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/01/montage-teleinfo.html"></div>

	<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Cela fait quelques mois que j&#8217;ai testé et mis en place un montage simple pour brancher mon compteur EDF sur Beaglebone et Raspberry Pi. Je vous restitue donc tout ce qu&#8217;il faut pour reproduire celui-ci chez vous. L&#8217;inspiration de ce montage provient du forum <a href="http://www.chaleurterre.com/forum/viewtopic.php?p=51607#51607">chaleurterre.com</a>. J&#8217;ai finalisé ce montage avec l&#8217;aide de zzdomi du forum <a href="http://www.touteladomotique.com/forum/viewtopic.php?f=30&amp;t=1513&amp;start=576">touteladomotique.com</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_principe">Principe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le compteur EDF fourni un signal appelé téléinfo pouvant être transformé en signal série TTL compatible avec les cartes Raspberry Pi ou BeagleBone. Les spécifications du signal teleinfo et de son protocole sont disponibles sur le <a href="http://www.erdfdistribution.fr/medias/DTR_Racc_Comptage/ERDF-NOI-CPT_02E.pdf">site d&#8217;ERDF en PDF</a>.</p>
</div>
<div class="paragraph">
<p>L&#8217;objet du montage de ce post est de réaliser cette transformation pour obtenir un signal compatible avec les UART des cartes récentes de type Raspberry Pi / BeagleBone / &#8230; (niveaux en 3.3V).</p>
</div>
<div class="paragraph">
<p>Le signal teleinfo des compteurs EDF doit être activé (configuration interne du compteur). Si ce signal n&#8217;est pas activé, il faut demander à EDF de venir chez vous le configurer. En effet, la configuration est réalisée sur la partie haute du compteur &#8230; qui vous est interdite d&#8217;accès (plombage). Ayant un compteur configuré dès son installation, je ne pourrais pas vous guider plus sur la démarche à suivre.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bornier_client_compteur_edf">Bornier client compteur EDF</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le bornier client du compteur EDF se situe sur sa partie basse comme le montre le schéma suivant :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_compteur.jpg" alt="Bornier compteur EDF teleinfo">
</div>
</div>
<div class="paragraph">
<p>Les bornes I1 et I2 fournissent le signal convoité. Vous pouvez utiliser du simple cable téléphonique et, dans des conditions optimales, la longueur de ce cable peut aller jusqu'à 500m (donnée des spécifications).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_montage_teleinfo_uart_ttl">Montage teleinfo &#8594; UART TTL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le montage utilise uniquement uniquement 3 composants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 optocoupleur <a href="http://www.vishay.com/docs/83675/sfh620a.pdf">SFH620A</a></p>
</li>
<li>
<p>1 résistance 1.2k</p>
</li>
<li>
<p>1 résistance 3.3k</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attention à prendre la référence exacte de l&#8217;optocoupleur car les latences (de basculement) de celui-ci sont importantes. Inutile donc de chercher des équivalences avec le même montage.</p>
</div>
<div class="paragraph">
<p>Comme le montre le schéma suivant, le montage est assez basique :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_schema.jpg" alt="Schéma montage Teleinfo">
</div>
</div>
<div class="paragraph">
<p>Vous pouvez tester ce montage sur une carte d&#8217;essai (breadboard) avant de passer à la soudure. Pour cela, utilisez un logiciel capable de lire un port série (screen ou minicom par exemple). Les caractéristiques de la communication sont "1200 7E1", ie. 1200 bauds, 7 bits de données, parité paire, 1 bit stop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cablage_sur_raspberry_pi_beaglebone_black">Cablage sur Raspberry Pi / Beaglebone Black</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le schéma Fritzing suivant montre le cablage pour la Raspberry Pi :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_rpi.jpg" alt="Cablage RPi Teleinfo">
</div>
</div>
<div class="paragraph">
<p>La même chose avec la Beaglebone Black :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_bbb.jpg" alt="Cablage Beaglebone Black Teleinfo">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin">Pour aller plus loin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Après la partie hardware, il faut passer à la partie software. Vous pouvez utiliser les programmes <a href="https://github.com/lhuet/teleinfo/tree/master/python/home/pi/teleinfo/python">Python</a> ou <a href="https://github.com/lhuet/tarifbleu-node">JavaScript</a> (node.js) que j&#8217;ai écrit par exemple.</p>
</div>
</div>
</div></p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'javadanslehardware'; 
            var disqus_identifier = 'montage_teleinfo';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>

	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="text-muted credit">L'ensemble des posts de ce blog sont publiés sous licence <em>Creative Commons by-nc-sa</em>. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
        <p class="text-muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.0.2</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- script src="/blog/js/jquery-1.10.2.min.js"></script -->
    <!-- script src="/blog/js/bootstrap.min.js"></script -->
    <script src="/blog/js/run_prettify.js"></script>

    <script type="text/javascript">
        window.___gcfg = {lang: 'fr'};

        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46154958-1', 'lhuet.github.io');
      ga('send', 'pageview');

    </script>
    
  </body>
</html>