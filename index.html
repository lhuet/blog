<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Java dans le hard(ware)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
    <!-- link href="/blog/css/bootstrap-theme.min.css" rel="stylesheet" -->
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">
	
      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Java dans le hard(ware)</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li><a href="/blog/index.html">Home</a></li>
              <li><a href="/blog/about.html">A propos</a></li>
              <li><a href="/blog/feed.xml">Flux RSS</a></li>
              <li><a href="/blog/archive.html">Archives</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
      <div class="container">

	<div class="page-header">
            <div class="row">
                <div class="col-xs-4 col-md-2"><img src="/blog/img/cafe-leopard-h150.png"></div>
                <div class="col-xs-12 col-md-8"><h1>Java dans le hard(ware)</h1></div>
            </div>
	</div>
  			<a href="/blog/2014/10/iot-arduino-rs485.html"><h1>Réseau "low cost" d&#8217;objets connectés en DIY avec le RS485</h1></a>
  			<p>05 octobre 2014</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/10/iot-arduino-rs485.html" data-text="Réseau "low cost" d&#8217;objets connectés en DIY avec le RS485" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/10/iot-arduino-rs485.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Une installation domotique est constituée de multiples capteurs et autres objets connectés (buzzword oblige). L&#8217;aspect communication est un élément clé de ce type d&#8217;installation. J&#8217;ai cherché à résoudre ce problème dans l&#8217;esprit du DIY et vous restitue dans ce billet la solution que j&#8217;ai commencée à mettre en oeuvre.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_r_seau_rs485">Réseau RS485</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je n&#8217;ai pas retenu les solutions à base de bus "industriels" (KNX par exemple) ou de composants "sans fils" du marché (ZigBee, Wifi, &#8230;). En effet, ce type de solution requiert un composant de communication assez couteux. Ce surcoût dépend beaucoup de la technologie. Cela peut aller de 10/15€ à plusieurs dizaines d&#8217;euros.
Pour du Wifi par exemple, on peut trouver des éléments à base de CC3000 chez <a href="https://www.sparkfun.com/products/12072">SparkFun</a> ou <a href="http://www.adafruit.com/product/1469">Adafruit</a> pour une trentaine d&#8217;euros. Si vous avez juste besoin d&#8217;activer un relais ou de récupérer une température, le cout de l'élément de communication devient prépondérant !</p>
</div>
<div class="paragraph">
<p>Mon choix s&#8217;est porté sur une solution à base de <a href="http://fr.wikipedia.org/wiki/EIA-485">RS485</a>. En effet, il s&#8217;agit d&#8217;un bus série avec les caractéristiques suivantes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>32 "devices" possibles sur le même bus</p>
</li>
<li>
<p>Jusqu'à 100kbits/s sur une longueur d&#8217;environ 1000 m</p>
</li>
<li>
<p>Half-duplex (du full-duplex pourrait se faire en RS422)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sa mise en oeuvre est plutôt aisée :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>utilisation de cables simples (paires torsadées de cable téléphonique par ex.)</p>
</li>
<li>
<p>"transceiver" bon marché</p>
</li>
<li>
<p>liaisons série UART répandues (Raspbery Pi, Arduino, &#8230;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>J&#8217;ai choisi les <a href="http://datasheets.maximintegrated.com/en/ds/MAX1487-MAX491.pdf">composants MAX485</a> qui sont très courant :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/max485.jpg" alt="IC MAX485">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/max485_pinconfig.png" alt="Configuration des pins du MAX485">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_objets_connect_s_avec_arduino">Objets connectés avec Arduino</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/arduino-mini-pro.jpg" alt="Arduino Mini Pro">
</div>
</div>
<div class="paragraph">
<p>Pour connecter les capteurs, j&#8217;ai choisi d&#8217;utiliser des arduinos dans la version "mini" pour son coût modique et sa très grosse communauté (et les librairies qui vont avec) !<br>
Les arduinos permettent d&#8217;utiliser à peu près n&#8217;importe quel capteur en offrant :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une dizaine de GPIO (entrée/sorties digitales)</p>
</li>
<li>
<p>des entrées (6) et sorties analogiques (6 PWM)</p>
</li>
<li>
<p>de l&#8217;I2C / SPI / UART (utilisée pour la communication sur le bus RS485).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le choix Arduino ouvre donc pas mal de possibilités.<br>
Le bus RS485 n&#8217;apporte cependant que la partie physique du réseau sans aucun protocole de communication. Ce protocole doit donc être implémenté sur les cartes arduino.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_r_seau_low_cost">Réseau "low cost"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comme pour beaucoup de projet en DIY, le coût est très faible.
Pour la liaison RS485, on peut trouver des MAX485 pour <a href="http://www.ebay.fr/itm/5PCS-MAXIM-MAX485CPA-MAX485-DIP-8-RS-485-RS-422-Transceiver-/130757415748?_trksid=p3984.m1497.l2649&amp;ssPageName=STRK:MEWNX:IT">à peine plus d&#8217;1 € les 5 sur ebay</a>.</p>
</div>
<div class="paragraph">
<p>Pour les arduinos, on peut trouver des "mini pro" <a href="http://cgi.ebay.fr/New-Pro-Mini-atmega328-Board-5V-16M-Replace-ATmega128-Arduino-Compatible-Nano-/131278764259?pt=LH_DefaultDomain_0&amp;hash=item1e90d2f8e3">à moins de 2 €</a>.</p>
</div>
<div class="paragraph">
<p>Au final, la "stack" pour connecter un objet coute de l&#8217;ordre de <strong>2 euros</strong> !</p>
</div>
<div class="paragraph">
<p>La mise en oeuvre d&#8217;un POC sera abordée dans mon prochain billet. En voici un aperçu pour vous donner l&#8217;eau à la bouche ;-)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/poc_rs485_oscillo.jpg" alt="IC MAX485">
</div>
</div>
</div>
</div></p>
                        <p><a href="/blog/2014/10/iot-arduino-rs485.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2014/06/gvm-on-beaglebone.html"><h1>Groovy, Gradle and Vert.x on Beaglebone with GVM</h1></a>
  			<p>23 juin 2014</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/06/gvm-on-beaglebone.html" data-text="Groovy, Gradle and Vert.x on Beaglebone with GVM" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/06/gvm-on-beaglebone.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://gvmtool.net/">GVM - the Groovy enVironment Manager</a> is a great tool for managing multiple versions of Groovy, Grails, Gradle, &#8230;
If you want to use Groovy, Vert.x and Gradle on Beaglebone like me, you have to check/install GVM dependencies.</p>
</div>
<div class="paragraph">
<p>Generally, Debian distrib. is used with Beaglebone and Raspberry Pi.
You can use the latest JDK from <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-arm-downloads-2187472.html">Oracle</a>.
While the JDK tar.gz file is uncompressed, you can add the following lines on my <code>~/.profile</code> file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>PATH="$PATH:$HOME/jdk1.8.0/bin"
JAVA_HOME="$HOME/jdk1.8.0/bin"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the JDK installation, use the <code>java -version</code> command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>debian@beaglebone:~$ java -version
java version "1.8.0"
Java(TM) SE Runtime Environment (build 1.8.0-b132)
Java HotSpot(TM) Client VM (build 25.0-b70, mixed mode)</code></pre>
</div>
</div>
<div class="paragraph">
<p>GVM is a bash tool and depends only on curl and unzip.
Unfortunately, unzip is not installed by default.
You&#8217;ll have to install these dependencies with a command like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>sudo apt-get install curl unzip</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now install GVM easily with the following command lines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>curl -s get.gvmtool.net | bash
source ~/.gvm/bin/gvm-init.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the installation, you can use the <code>gvm version</code> command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>debian@beaglebone:~$ gvm version
Groovy enVironment Manager 1.3.13</code></pre>
</div>
</div>
<div class="paragraph">
<p>The latest version of Groovy, Gradle and vert.x can be installed with the following commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>gvm install groovy
gvm install vertx
gvm install gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command tells you which Vert.x versions are installed / available</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>debian@beaglebone:~$ gvm list vertx

================================================================================
Available Vertx Versions
================================================================================
 &gt; * 2.1
     2.0.2-final
     2.0.1-final
     2.0.0-final
     1.3.1.final
     1.3.0.final
     1.2.2.final
     1.2.1.final
     1.2.0.final
     1.1.0.final

================================================================================
+ - local version
* - installed
&gt; - currently in use
================================================================================</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check Vert.x installation with the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>debian@beaglebone:~$ vertx version
2.1 (built 2014-05-27 12:39:02)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now, you are ready to use <a href="http://vertx.io/">Vert.x</a> on Beaglebone :-)</p>
</div>
</div>
</div></p>
                        <p><a href="/blog/2014/06/gvm-on-beaglebone.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2014/06/likebox.html"><h1>"LikeBox" du BreizhCamp</h1></a>
  			<p>09 juin 2014</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/06/likebox.html" data-text=""LikeBox" du BreizhCamp" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/06/likebox.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>L'édition 2014 du <a href="http://www.breizhcamp.org">BreizhCamp</a> a été l&#8217;occasion pour la team d&#8217;innover en mettant en place un boitier de vote pour récupérer le feedback des participants à la sortie de chaque conférence.
L&#8217;idée n'était pas si originale que cela puisque nous avons découvert en cours de réalisation que Devoxx France allait également avoir ce type de boitier.
Bien évidemment, le notre était beaucoup mieux :-p</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/boitier_final.jpeg" alt="LikeBox">
</div>
</div>
<div class="paragraph">
<p>Dans cet article, je me focalise sur la partie technique à l&#8217;intérieur du boitier.
<a href="http://blog.loof.fr/2014/06/votre-avis-nous-interesse-aka-likebox.html">Nicolas</a> donne un autre point de vue sur la partie organisationnelle / habillage du hardware / marketing / whatever &#8230;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_de_l_id_e_au_prototype">De l&#8217;idée au prototype</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;idée de départ était de voir ce qu&#8217;on pouvait mettre en place pour que les participants puissent s&#8217;exprimer autrement qu&#8217;en mettant une croix sur une feuille A3 (solution utilisée pour l'édition 2013).
Intéressé par le hardware, c&#8217;est naturellement par ce coté que j&#8217;ai commencé.
Le premier prototype fait sur un coin de table était à base d&#8217;arduino :</p>
</div>
<div align="center">
<iframe width="640" height="480" src="//www.youtube.com/embed/y5-cCQxtZTw" frameborder="0" allowfullscreen></iframe>
</div>
<div class="paragraph">
<p>Le code n'était pas d&#8217;une finesse extrême, mais c'était un prototype fonctionnel !
Pour ceux que ça intéresse, vous pouvez le retrouver <a href="http://lhuet.github.io/blog/boitier_vote/boitiervote.ino">ici</a>.</p>
</div>
<div class="paragraph">
<p>Au delà de l&#8217;aspect technique, ce prototype a été une base de discussion avec la team sur les fonctionnalités à mettre en oeuvre :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nombre de boutons (2, 3, +) ?</p>
</li>
<li>
<p>Ecran texte ou Ecran graphique ?</p>
</li>
<li>
<p>Forme/Type de bouton ?</p>
</li>
<li>
<p>Intégration de l&#8217;ensemble</p>
</li>
<li>
<p>&#8230;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_choix_techniques">Choix techniques</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Globalement, les choix techniques du coeur du boitier ont été guidés par les compétences de l'équipe, le matériel dejà disponible et le coût.
Le leitmotiv de l'équipe a été de faire <strong>simple</strong> et <strong>robuste</strong>.</p>
</div>
<div class="sect2">
<h3 id="_c_t_hardware">Côté hardware</h3>
<div class="paragraph">
<p>La partie hardware est constitué de 3 élements principaux :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les boutons de vote (interaction avec les utilisateurs &#8230; donc aspect fondamental du boitier)</p>
</li>
<li>
<p>L'écran de visualisation</p>
</li>
<li>
<p>La carte contenant pour faire tourner la partie software</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour les boutons de vote, le bouton type "champignon" nous est paru essentiel.
Cela a été le choix le plus difficile à faire compte tenu du nombre de boutons disponibles sur le marché et de la diversité des tarifs.
Pour les côtés robuste et visuel, nous avons retenu des boutons métaliques industriels et passé commande chez <a href="http://fr.farnell.com/itw-switches/76-9450-439088r/commutateur-rouge-domed/dp/241520?MER=en-me-pd-r2-alte-swi">Farnell</a>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/green_switch.jpg" alt="Bouton 'Domed'">
</div>
</div>
<div class="paragraph">
<p>Pour les écrans, j&#8217;ai fait quelques tests avec divers écrans LCD Texte 2/4 lignes, LCD graphique entre 2 et 3".
Au final, nous avons retenu l'écran LCD Texte sur 4 lignes avec un fond bleu pour des questions de lisibilité et de simplicité.
Une version avec bus I2C a été choisie dans un souci de simplicité de cablage.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/ecrans.jpg" alt="Test d'écrans">
</div>
</div>
<div class="paragraph">
<p>Pour la carte principale, le choix a été rapide : Raspberri Pi.
Nous n'étions pas nombreux à avoir de l&#8217;expérience sur Arduino et nous avions plusieurs Raspberry Pi (pas d&#8217;achat à prévoir de ce coté).
L&#8217;arduino aurait été une solution plus robuste mais la Raspberry Pi apportait d&#8217;autres possibilités (sortie HDMI pour gérer un autre affichage, connectivité réseau intégré, &#8230;).</p>
</div>
<div class="paragraph">
<p>Allez hop, les commandes ont été passées et nous étions prêt pour notre soirée montage avec la matière première :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/pieces.jpg" alt="Pièces avant montage">
</div>
</div>
<div class="paragraph">
<p><a href="https://twitter.com/alexlg">Alexandre</a> nous a préparé pour l&#8217;occasion un joli schéma <a href="http://fritzing.org/">Fritzing</a> :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/wiring.jpg" alt="Schéma Fritzing">
</div>
</div>
<div class="paragraph">
<p>Alexandre a même optimisé / conçu le cablage pour avoir une mise en oeuvre la plus simple possible :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pas de condensateur anti-rebond (gestion coté soft)</p>
</li>
<li>
<p>boutons en mode <em>pull up</em> (plus de pins GND disponibles que de 3.3 V)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_c_t_software">Côté software</h3>
<div class="paragraph">
<p>Les sources sont disponibles sur Github dans <a href="https://github.com/BreizhJUG/breizhcamp-vote">repo dédié</a>.
Dans le contexte du BreizhCamp, le développement a été guidé par la simplicité de mise en oeuvre et par la robustesse.
En termes de spécifications, cela peut se traduire par :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>je branche &#8594; ça marche</p>
</li>
<li>
<p>je m&#8217;endors sur le bouton &#8594; pas grave, un seul vote est pris en compte</p>
</li>
<li>
<p>tolérant aux pannes réseau (réseau filaire que la team a mis en place)</p>
</li>
<li>
<p>support des changements de programme de dernière minute</p>
</li>
<li>
<p>boitiers autonomes et envoi des votes régulièrement à un serveur si c&#8217;est possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il y a 2 parties software :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/BreizhJUG/breizhcamp-vote/tree/master/client">la partie cliente</a> sur le boitier de vote</p>
</li>
<li>
<p><a href="https://github.com/BreizhJUG/breizhcamp-vote/tree/master/server">la partie serveur</a> qui aggrège les données de l&#8217;ensemble des boitiers de vote (nous en avions 5) et les expose sous forme d&#8217;API REST.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour faire simple et léger (en particulier sur le Raspberry Pi), <a href="http://nodejs.org/">Node.js</a> a été choisi.
En plus de la légèreté, la diversité de ses modules, notamment pour l&#8217;interfaçage Hardware, a contribué à ce choix.
Les principaux modules utilisés sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/fivdi/onoff">onoff</a> pour gérer les boutons (GPIO)</p>
</li>
<li>
<p><a href="https://github.com/wilberforce/lcd-pcf8574">lcd-pcf8574</a> pour gérer l'écran LCD 4 lignes</p>
</li>
<li>
<p><a href="https://github.com/mapbox/node-sqlite3">sqlite3</a> pour stocker localement les données de vote dans une base de données fichier SQLite3.</p>
</li>
<li>
<p><a href="https://github.com/danwrong/restler">restler</a> pour l&#8217;implémentation du client REST sur les boitiers</p>
</li>
<li>
<p><a href="https://www.npmjs.org/package/express">express</a> pour la partie serveur</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Les modules cités vous auront déjà donnés la puce à l&#8217;oreille. La communication entre les boitiers et le serveur se fait uniquement sur HTTP (simple API REST).</p>
</div>
<div class="paragraph">
<p>La restitution est réalisée avec une simple <a href="https://github.com/BreizhJUG/breizhcamp-vote/blob/master/server/static/index.html">page Web</a> sur laquelle on n&#8217;est pas peu fier de retrouver sa session ;-) :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/top5.jpg" alt="Top 5 des talks">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tout n&#8217;a pas été aussi rose, nous avions un peu sous-estimé le temps de mise en oeuvre, notamment des copies de cartes SD.
En effet, copier une carte SD de 8Go peut parfois prendre plus de 40mn.
Ceci étant, une fois les boitiers en place et les rares bugs corrigés (dont un souci de performances sur un module node &#8230; coté serveur), tout à fonctionné à merveille !</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/boitier_vote/boitier_final_bzhcmp2.jpg" alt="Boitier en fonctionnement">
</div>
</div>
<div class="paragraph">
<p>Au final, ce système a permis de prendre en compte près de <strong>2500 votes</strong> !</p>
</div>
<div class="paragraph">
<p>Je tiens à conclure pour souligner que ceci résulte d&#8217;un véritable travail d'équipe :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infrastructure réseau (5 routeurs configurés dans chaque salle sur lesquels les boitiers étaient reliés au réseau)</p>
</li>
<li>
<p>Montage de l&#8217;ensemble des boitiers en une soirée par toute l'équipe</p>
</li>
<li>
<p>Développement <a href="https://github.com/BreizhJUG/breizhcamp-vote/graphs/contributors">du code à 4</a> (je me compte dedans même si j&#8217;ai plus été "product owner" que développeur)</p>
</li>
<li>
<p>Préparation de l&#8217;intégration (plaques plexi, pieds, &#8230;) par Nicolas et son fils Julien</p>
</li>
<li>
<p>Montage de 3 TV en HDMI sur 3 des boitiers</p>
</li>
<li>
<p>Configuration système de l&#8217;ensemble des éléments (boitiers et serveur)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Prochaine étape : Diffusion du projet sur le portfolio du <a href="http://www.labfab.fr/">LabFab</a> prêt à promouvoir notre <em>LikeBox</em> en vue d&#8217;une réutilisation sur d&#8217;autres évènements.</p>
</div>
</div>
</div></p>
                        <p><a href="/blog/2014/06/likebox.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2014/01/teleinfo-raspberrypi.html"><h1>Teleinfo - Préparation d&#8217;une Raspberry Pi</h1></a>
  			<p>26 janvier 2014</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/01/teleinfo-raspberrypi.html" data-text="Teleinfo - Préparation d&#8217;une Raspberry Pi" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/01/teleinfo-raspberrypi.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vous avez lu attentivement mon post précédent sur le <a href="http://lhuet.github.io/blog/2014/01/montage-teleinfo.html">montage teleinfo</a>, récupéré l&#8217;optocoupleur qui va bien et sorti votre Raspberry Pi du placard. Maintenant, vous être prêt à passer à la partie soft.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pr_paration_de_l_0s">Préparation de l&#8217;0S</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_la_carte_sd">La carte SD</h3>
<div class="paragraph">
<p>Le point de départ est la distribution <a href="http://www.raspberrypi.org/downloads">raspbian officielle</a> que vous devez télécharger. Pour flasher une carte SD, je vous suggère de suivre les instructions sur le site <a href="http://elinux.org/RPi_Easy_SD_Card_Setup">elinux.org</a>.</p>
</div>
<div class="paragraph">
<p>Si vous êtes sous linux, vous pouvez utiliser une commande du genre :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dd bs=4M if=./2013-09-25-wheezy-raspbian.img of=/dev/sdb</pre>
</div>
</div>
<div class="paragraph">
<p>Attention, dans mon cas, <code>/dev/sdb</code> correspond à ma carte SD. Ne pas copier/coller cette ligne "à l&#8217;aveugle" &#8230; Si <code>/dev/sdb</code> correspond chez vous à un disque dur, vous risquez d&#8217;avoir quelques sueurs froides !</p>
</div>
</div>
<div class="sect2">
<h3 id="_d_sactivation_de_la_console_s_rie">Désactivation de la console série</h3>
<div class="paragraph">
<p>La Raspberry Pi ne dispose que d&#8217;un seul port série. Celui-ci est utilisé par défaut pour avoir une console. Il faut donc libérer le port série pour le montage téléinfo.</p>
</div>
<div class="paragraph">
<p>Désactiver de la console série au boot en modifiant le fichier <code>/boot/cmdline.txt</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>dwc_otg.lpm_enable=0 console=ttyAMA0,115200 kgdboc=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait</pre>
</div>
</div>
<div class="paragraph">
<p>à remplacer par :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dwc_otg.lpm_enable=0 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait</pre>
</div>
</div>
<div class="paragraph">
<p>Désactiver la console <code>getty</code> en modifiant le fichier <code>/etc/inittab</code>. Il suffit de commenter la dernière ligne du fichier (ajout d&#8217;un <code>#</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#T0:23:respawn:/sbin/getty -L ttyAMA0 115200 vt100</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logguer_les_donn_es_dans_une_base_a_href_http_www_mongodb_org_mongodb_a">Logguer les données dans une base <a href="http://www.mongodb.org/">MongoDB</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cette partie corresond à l&#8217;installation et la configuration d&#8217;un programme <a href="http://nodejs.org/">nodejs</a> pour logguer les infos dans une base MongoDB. Dans mon cas, j&#8217;utilise une formule d&#8217;hébergement gratuite avec 512 Mo chez <a href="https://mongolab.com/">MongoLab</a>. Vous pouvez choisir n&#8217;importe quel fournisseur à ce niveau (<a href="http://www.mongohq.com/">MongoHQ</a> offre le même type de formule par exemple).</p>
</div>
<div class="sect2">
<h3 id="_installation_de_nodejs">Installation de nodejs</h3>
<div class="paragraph">
<p>Il y a quelques temps, il était difficile de trouver une version nodejs pour processeur ARM. Il fallait donc compiler les sources sur Raspberry Pi (~45 mn de temps de compilation) ou, pour les plus avertis, en "Cross Compiling" (moins de 2mn sur mon core i7). Désormais, une version officielle est disponible mais pas toujours dans la dernière version. Il faut donc fouiller dans les répertoires <a href="http://nodejs.org/dist/">http://nodejs.org/dist/</a>. La dernière version à ce jour est la <a href="http://nodejs.org/dist/v0.10.24/node-v0.10.24-linux-arm-pi.tar.gz">v0.10.24</a>.</p>
</div>
<div class="paragraph">
<p>L&#8217;installation consiste uniquement à décompresser l&#8217;archive :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tar -xzvf node-v0.10.24-linux-arm-pi.tar.gz</pre>
</div>
</div>
<div class="paragraph">
<p>Si vous installez nodejs dans le répertoire <code>/opt</code>, vous pouvez ajouter les lignes suivantes au fichier <code>/etc/profile</code> pour positionner les variables d&#8217;environnement pour node :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>NODE_JS_HOME="/opt/node"
PATH="$PATH:$NODE_JS_HOME/bin"
NODE_PATH="$NODE_JS_HOME/lib/node_modules"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_nodejs">Application nodejs</h3>
<div class="paragraph">
<p>Vous pouvez commencer en utilisant mon application (en cours de développement) en clonant le repo git associé :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/lhuet/teleinfo-app.git</pre>
</div>
</div>
<div class="paragraph">
<p>Pour obtenir les dépendances node, utilisez la commande classique node :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>npm install -g</pre>
</div>
</div>
<div class="paragraph">
<p>Le programme va chercher les éléments de configuration dans des variables d&#8217;environnement que vous pouvez positionner avec la commandes suivantes :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>export MONGO_LOGIN="LOGIN_MONGOLAB"
export MONGO_PASSWORD="PASSWORD_MONGOLAB"
export MONGO_HOST="HOST_MONGOLAB"
export MONGO_PORT="PORT_MONGOLAB"
export MONGO_DATABASE="BASE_MONGOLAB"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour lancer l&#8217;application manuellement, vous devez positionner ces variables d&#8217;environnement et utiliser la commande :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>node teleinfo-app.js</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_script_de_d_marrage">Script de démarrage</h3>
<div class="paragraph">
<p>Lancer manuellement son application suffit en phase de développement. Pour être certain que le script se lance au démarrage de votre Raspberry Pi, vous devez faire un script du genre :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint bash language-bash"><code>#!/bin/sh
#/etc/init.d/node-teleinfo

export PATH=$PATH:/opt/node/bin
export NODE_PATH=$NODE_PATH:/opt/node/lib/node_modules
export MONGO_LOGIN="LOGIN_MONGOLAB"
export MONGO_PASSWORD="PASSWORD_MONGOLAB"
export MONGO_HOST="HOST_MONGOLAB"
export MONGO_PORT="PORT_MONGOLAB"
export MONGO_DATABASE="BASE_MONGOLAB"

case "$1" in
  start)
  exec forever --sourceDir=/home/pi/teleinfo-app -p /tmp teleinfo-app.js
&amp;
  ;;
stop)
  exec forever stop --sourceDir=/home/pi/teleinfo-app teleinfo-app.js
  ;;
*)
  echo "Usage: /etc/init.d/node-teleinfo {start|stop}"
  exit 1
  ;;
esac

exit 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>La commande suivante permet de configurer votre système pour que le script se lance au démarrage :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo update-rc.d node-teleinfo defaults</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_la_suite">Pour la suite &#8230;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maintenant que les données sont stockées, il va falloir les restituer ! Je n&#8217;ai pas encore beaucoup avancé sur cette partie. J&#8217;ai commencé à intégrer express pour avoir des infos "live" (puissance instantanée, intensité instantanée et index) . Il reste toute la partie exploitation des données.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai oublié de le préciser, mais j&#8217;accepte les pull-requests ;-)</p>
</div>
<div class="paragraph">
<p>A suivre donc.</p>
</div>
</div>
</div></p>
                        <p><a href="/blog/2014/01/teleinfo-raspberrypi.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2014/01/montage-teleinfo.html"><h1>Montage teleinfo pour Raspberry Pi / BeagleBone</h1></a>
  			<p>19 janvier 2014</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2014/01/montage-teleinfo.html" data-text="Montage teleinfo pour Raspberry Pi / BeagleBone" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2014/01/montage-teleinfo.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Cela fait quelques mois que j&#8217;ai testé et mis en place un montage simple pour brancher mon compteur EDF sur Beaglebone et Raspberry Pi. Je vous restitue donc tout ce qu&#8217;il faut pour reproduire celui-ci chez vous. L&#8217;inspiration de ce montage provient du forum <a href="http://www.chaleurterre.com/forum/viewtopic.php?p=51607#51607">chaleurterre.com</a>. J&#8217;ai finalisé ce montage avec l&#8217;aide de zzdomi du forum <a href="http://www.touteladomotique.com/forum/viewtopic.php?f=30&amp;t=1513&amp;start=576">touteladomotique.com</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_principe">Principe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le compteur EDF fourni un signal appelé téléinfo pouvant être transformé en signal série TTL compatible avec les cartes Raspberry Pi ou BeagleBone. Les spécifications du signal teleinfo et de son protocole sont disponibles sur le <a href="http://www.erdfdistribution.fr/medias/DTR_Racc_Comptage/ERDF-NOI-CPT_02E.pdf">site d&#8217;ERDF en PDF</a>.</p>
</div>
<div class="paragraph">
<p>L&#8217;objet du montage de ce post est de réaliser cette transformation pour obtenir un signal compatible avec les UART des cartes récentes de type Raspberry Pi / BeagleBone / &#8230; (niveaux en 3.3V).</p>
</div>
<div class="paragraph">
<p>Le signal teleinfo des compteurs EDF doit être activé (configuration interne du compteur). Si ce signal n&#8217;est pas activé, il faut demander à EDF de venir chez vous le configurer. En effet, la configuration est réalisée sur la partie haute du compteur &#8230; qui vous est interdite d&#8217;accès (plombage). Ayant un compteur configuré dès son installation, je ne pourrais pas vous guider plus sur la démarche à suivre.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bornier_client_compteur_edf">Bornier client compteur EDF</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le bornier client du compteur EDF se situe sur sa partie basse comme le montre le schéma suivant :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_compteur.jpg" alt="Bornier compteur EDF teleinfo">
</div>
</div>
<div class="paragraph">
<p>Les bornes I1 et I2 fournissent le signal convoité. Vous pouvez utiliser du simple cable téléphonique et, dans des conditions optimales, la longueur de ce cable peut aller jusqu'à 500m (donnée des spécifications).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_montage_teleinfo_uart_ttl">Montage teleinfo &#8594; UART TTL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le montage utilise uniquement uniquement 3 composants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 optocoupleur <a href="http://www.vishay.com/docs/83675/sfh620a.pdf">SFH620A</a></p>
</li>
<li>
<p>1 résistance 1.2k</p>
</li>
<li>
<p>1 résistance 3.3k</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attention à prendre la référence exacte de l&#8217;optocoupleur car les latences (de basculement) de celui-ci sont importantes. Inutile donc de chercher des équivalences avec le même montage.</p>
</div>
<div class="paragraph">
<p>Comme le montre le schéma suivant, le montage est assez basique :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_schema.jpg" alt="Schéma montage Teleinfo">
</div>
</div>
<div class="paragraph">
<p>Vous pouvez tester ce montage sur une carte d&#8217;essai (breadboard) avant de passer à la soudure. Pour cela, utilisez un logiciel capable de lire un port série (screen ou minicom par exemple). Les caractéristiques de la communication sont "1200 7E1", ie. 1200 bauds, 7 bits de données, parité paire, 1 bit stop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cablage_sur_raspberry_pi_beaglebone_black">Cablage sur Raspberry Pi / Beaglebone Black</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le schéma Fritzing suivant montre le cablage pour la Raspberry Pi :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_rpi.jpg" alt="Cablage RPi Teleinfo">
</div>
</div>
<div class="paragraph">
<p>La même chose avec la Beaglebone Black :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/teleinfo_bbb.jpg" alt="Cablage Beaglebone Black Teleinfo">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin">Pour aller plus loin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Après la partie hardware, il faut passer à la partie software. Vous pouvez utiliser les programmes <a href="https://github.com/lhuet/teleinfo/tree/master/python/home/pi/teleinfo/python">Python</a> ou <a href="https://github.com/lhuet/tarifbleu-node">JavaScript</a> (node.js) que j&#8217;ai écrit par exemple.</p>
</div>
</div>
</div></p>
                        <p><a href="/blog/2014/01/montage-teleinfo.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2013/12/jdk7-jdk8-sur-beaglebone.html"><h1>Java 7 et 8 sur BeagleBone Black (BBB)</h1></a>
  			<p>14 décembre 2013</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2013/12/jdk7-jdk8-sur-beaglebone.html" data-text="Java 7 et 8 sur BeagleBone Black (BBB)" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2013/12/jdk7-jdk8-sur-beaglebone.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mon second post est une réponse détaillée à une question posée par <a href="https://twitter.com/CodeStory/status/404649263134941185">@CodeStory</a> sur twitter.
140 caractères étaient largement insuffisants ! Ma réponse va également un peu plus loin puisque je compare les performances du JDK7 et du JDK8.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quel_jdk_pour_beaglebone_black">Quel JDK pour BeagleBone Black ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La première question qu&#8217;on peut se poser est : <strong>Quelle version de JDK utiliser ?</strong><br></p>
</div>
<div class="paragraph">
<p>Sur le site d&#8217;Oracle, on trouve 2 versions différentes pour le JDK 7:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Linux ARM v6/v7 Hard Float ABI"</p>
</li>
<li>
<p>"Linux ARM v6/v7 Soft Float ABI"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aucun JDK8 n&#8217;est proposé sur le site d&#8217;Oracle (pas encore de version finale). On trouve une "Early Access Release" sur <a href="https://jdk8.java.net/download.html">jdk8.java.net</a> sous le nom :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Linux ARMv6/7 VFP, HardFP ABI"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ces JDK peuvent être utilisés sur BBB (ARM v7) et sur Raspberry Pi (ARM v6) &#8230; mais pas sous n&#8217;importe quelle version d&#8217;OS.</p>
</div>
<div class="sect2">
<h3 id="_hard_float_vs_soft_float">Hard Float vs Soft Float</h3>
<div class="paragraph">
<p>"Hard Float" et "Soft Float" sont des termes utilisés pour des jeux d&#8217;instruction spécifiques des processeurs ARM. Historiquement, le JDK d&#8217;Oracle n'était disponible qu&#8217;en version "Soft Float".
Quelques éléments de réponses se trouvent également dans les slides de mon quickie de Devoxx France 2013 sur <a href="http://parleys.com/play/5156c4d6e4b0c779d7881405">parleys</a>.<br>
Pour faire court, les JDK en version HFP (Hard Float) ne peuvent être utilisés que sur des OS compatible HFP.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quel_os_utiliser">Quel OS utiliser ?</h3>
<div class="paragraph">
<p>La carte BBB est livrée avec une distribution Angström &#8230; qui est compilée en "Soft Float". Seul le JDK 7 "Soft Float" peut donc être utilisé avec cet OS. Aucune version "Soft Float" du JDK 8 n&#8217;est disponible à ma connaissance.</p>
</div>
<div class="paragraph">
<p>Pour utiliser les JDK 7 et 8 en version HFP, il faut un Linux compatible. C&#8217;est le cas d&#8217;Ubuntu. Vous pouvez vous inspirez du <a href="http://learn.adafruit.com/beaglebone-black-installing-operating-systems/overview">tutoriel d&#8217;Adafruit</a> pour installer une nouvelle version d&#8217;OS sur la BBB ou, comme je l&#8217;ai fait, booter sur une microSD externe contenant Ubuntu.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests_de_performances">Tests de performances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>J&#8217;ai repris les mêmes types de tests que pour mon <a href="http://parleys.com/play/5156c4d6e4b0c779d7881405">quickie de Devoxx France 2013</a>, à savoir, des tests <a href="http://www.dacapobench.org/">dacapo</a> (avrora, fop et xalan). Les scores sont ramenés sur une base 100 ayant pour référence les résultats sur JDK7 sur Rapsberry Pi de mon Quickie. J&#8217;ai consigné les valeurs brutes dans un <a href="http://lhuet.github.io/blog/perfs_jdk7_jdk8_bbb.ods">fichier LibreOffice</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Ces tests ont seulement pour objectif de comparer grossièrement les JDK &#8230; et n&#8217;ont fait l&#8217;objet d&#8217;aucune méthodologie, analyse statistique, &#8230; Pour avoir des résultats indiscutables, il faudrait des tests réalisés par des spécialistes de JVM, ce que je ne suis pas !
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Voici donc 2 graphes avec/sans référence à la Raspberry Pi.</p>
</div>
<style type="text/css">
.legend {
    /* width: 13em; */
    /* border: 1px solid black; */
}

.legend .title {
    display: block;
    margin: 0.2em;
    border-style: solid;
    border-width: 0 0 0 1em;
    padding: 0 0.3em;
}
#perfWithRPiLegend, #perfWithoutRPiLegend {
    /* display: inline-block;
    position: absolute; */
    margin-top: 20px;
}
#perfsWithRPi, #perfsWithoutRPi {
    margin-top:20px;
}
</style>

<div class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="panel panel-default">
                <div class="row">
                    <div class="col-md-8">
                        <canvas id="perfsWithoutRPi"></canvas>
                    </div>
                    <div class="col-md-4">
                        <div id="perfWithoutRPiLegend"></div>
                    </div>
                </div>
                <div class="panel-footer text-center">JDK 7/8 SFP/HFP Beaglebone Black</div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="panel panel-default">
                <div class="row">
                    <div class="col-md-8">
                        <canvas id="perfsWithRPi"></canvas>
                    </div>
                    <div class="col-md-4">
                        <div id="perfWithRPiLegend"></div>
                    </div>
                </div>
                <div class="panel-footer text-center">JDK 7/8 SFP/HFP BBB et Raspberry Pi</div>
            </div>
        </div>
    </div>
</div>

<script src="/blog/js/Chart.min.js"></script>
<script>
/* <a href="https://github.com/bebraw/Chart.js.legend">https://github.com/bebraw/Chart.js.legend</a> */
function legend(parent, data) {
    parent.className = 'legend';
    var datas = data.hasOwnProperty('datasets') ? data.datasets : data;

    datas.forEach(function(d) {
        var title = document.createElement('span');
        title.className = 'title';
        title.style.borderColor = d.hasOwnProperty('strokeColor') ? d.strokeColor : d.color;
        title.style.borderStyle = 'solid';
        parent.appendChild(title);

        var text = document.createTextNode(d.title);
        title.appendChild(text);
    });
}
</script>
<script>
var data = {
	labels : ["Avrora","Fop","Xalan"],
	datasets : [
		{
			fillColor : "rgba(0, 69, 134, 0.8)",
			strokeColor : "rgba(0, 69, 134,1)",
			data : [100,100,100],
            title : "JDK7 Soft Float - RPi"
		},
		{
			fillColor : "rgba(255, 66, 14, 0.8)",
			strokeColor : "rgba(255, 66, 14,1)",
			data : [21.76,41.23,30.35],
            title : "JDK7 Soft Float - BBB"
		},
		{
			fillColor : "rgba(255, 210, 31, 0.8)",
			strokeColor : "rgba(255, 210, 31,1)",
			data : [22.9,40,31.07],
            title : "JDK7 Hard Float - BBB"
		},
		{
			fillColor : "rgba(87, 157, 28, 0.8)",
			strokeColor : "rgba(87, 157, 28, 1)",
			data : [23.55,42.58,31.49],
            title : "JDK8 Hard Float - BBB"
		}
	]
}
var data2 = {
	labels : ["Avrora","Fop","Xalan"],
	datasets : [
		{
			fillColor : "rgba(255, 66, 14, 0.8)",
			strokeColor : "rgba(255, 66, 14,1)",
			data : [21.76,41.23,30.35],
            title : "JDK7 Soft Float - BBB"
		},
		{
			fillColor : "rgba(255, 210, 31, 0.8)",
			strokeColor : "rgba(255, 210, 31,1)",
			data : [22.9,40,31.07],
            title : "JDK7 Hard Float - BBB"
		},
		{
			fillColor : "rgba(87, 157, 28, 0.8)",
			strokeColor : "rgba(87, 157, 28, 1)",
			data : [23.55,42.58,31.49],
            title : "JDK8 Hard Float - BBB"
		}
	]
}
var options = {
    scaleOverride: true,
    scaleSteps : 5,
    scaleStepWidth: 20,
    scaleStartValue: 0
}
var options2 = {
    scaleOverride: true,
    scaleSteps : 5,
    scaleStepWidth: 10,
    scaleStartValue: 0
}

function draw() {
    var perfsWithRPi = document.getElementById("perfsWithRPi");
    perfsWithRPi.width = perfsWithRPi.parentNode.clientWidth - 30;
    perfsWithRPi.height=350;
    console.log(perfsWithRPi.width);
    var ctx = perfsWithRPi.getContext("2d");
    new Chart(ctx).Bar(data, options);

    var perfsWithoutRPi = document.getElementById("perfsWithoutRPi");
    perfsWithoutRPi.width = perfsWithoutRPi.parentNode.clientWidth - 30;
    perfsWithoutRPi.height=350;
    var ctx2 = perfsWithoutRPi.getContext("2d");
    new Chart(ctx2).Bar(data2, options2);
}
draw();
legend(document.getElementById("perfWithRPiLegend"), data);
legend(document.getElementById("perfWithoutRPiLegend"), data2);

window.onresize = function() {
    /* Canvas à redessiner, responsive oblige ! */
    draw();
};
</script>
<div class="paragraph">
<p>En conclusion, les performances ne sont pas fondamentalement différentes. Si vous êtes sur l&#8217;OS de base sur la Beaglebone, vous n&#8217;avez donc pas besoin d&#8217;en changer &#8230; sauf si vous voulez tester les nouveautés du JDK8.</p>
</div>
<div class="paragraph">
<p>Autre enseingement : Si vous faites tourner du code Java sur une Raspberry Pi, vous auriez avantage à passer sur Beaglebone Black !</p>
</div>
</div>
</div></p>
                        <p><a href="/blog/2013/12/jdk7-jdk8-sur-beaglebone.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2013/12/beaglebone-black-overview.html"><h1>Premiers pas avec la BeagleBone Black (BBB)</h1></a>
  			<p>08 décembre 2013</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2013/12/beaglebone-black-overview.html" data-text="Premiers pas avec la BeagleBone Black (BBB)" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2013/12/beaglebone-black-overview.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mon premier post technique sera sur la carte <a href="http://www.beagleboard.org/Products/BeagleBone%20Black">BeagleBone Black</a> (ma 3ème BeagleBone).
Pas de Java pour le moment, mais ça va venir &#8230; Je préfère commencer par le Hard !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pr_sentation_de_la_beaglebone_black">Présentation de la BeagleBone Black</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il s&#8217;agit d&#8217;une carte à base de processeur ARMv7 avec un coût relativement modique (~45$) et une consommation électrique faible (de l&#8217;ordre du Watt).
Cette carte est parfois appelée <em>BeagleBone Next-gen</em>
car elle a été précédée par une première version très proche physiquement : <a href="http://www.beagleboard.org/Products/BeagleBone">la BeagleBone</a>.
Open source "sur toute la ligne" (hardware et software), vous pouvez retrouvez les plans complets sur <a href="https://github.com/CircuitCo/BeagleBone-Black">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Son rapport "coût/connectivité" est assez intéressant. Ceci en fait un choix pertinent pour des installations de type domotique, robotique, &#8230;
(possibilité de gérer de nombreux capteurs).<br>
Avant d&#8217;aller plus loin, la voici en image :</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/CONN_REVA5A.jpg" alt="Beaglebone Black">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_caract_ristiques_techniques">Caractéristiques techniques</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cot_hardware">Coté hardware</h3>
<div class="paragraph">
<p>On retrouve :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU ARM Cortex-A8 @1GHz</p>
</li>
<li>
<p>512 Mo RAM DDR3</p>
</li>
<li>
<p>2 Go eMMC (stockage interne)</p>
</li>
<li>
<p>Ethernet / 1xUSB / µHDMI / MicroSD / 2 ports d&#8217;extension 2x23 pins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Les ports d&#8217;extension méritent un détour. C&#8217;est d&#8217;ailleurs un atout majeur de cette carte :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>65 GPIO (entrée/sortie numérique)</p>
</li>
<li>
<p>8 PWM ("Pulse Width Modulation" ~ sorties analogiques pour caricaturer)</p>
</li>
<li>
<p>7 entrées analogiques</p>
</li>
<li>
<p>5 UART (ports série)</p>
</li>
<li>
<p>Bus divers (3 I2C, 1 SPI, 1 CAN)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il y a d&#8217;autres possibilités pour une utilisation plus avancée (PRU, Timers, &#8230;) sur lesquels je ne vais pas aller plus loin (pour le moment).
Pour avoir plus de détails, vous pouvez consulter la dernière version
de la <a href="https://github.com/CircuitCo/BeagleBone-Black/blob/master/BBB_SRM.pdf?raw=true">documentation de référence</a> disponible sur le projet <a href="https://github.com/CircuitCo/BeagleBone-Black">GitHub</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cot_software">Coté software</h3>
<div class="paragraph">
<p>Il ne s&#8217;agit pas d&#8217;une carte avec micro-controlleur (ARM Cortex-M, Atmel sur Arduino, &#8230;) mais d&#8217;une carte avec un micro-processeur.
Cela signifie que cette carte fonctionne avec un OS.
Même si cet environnement est restreint, vous êtes très proche de ce que vous pourriez avoir sur n&#8217;importe quel système avec OS.</p>
</div>
<div class="paragraph">
<p>Les OS connus pour fonctionner sont (liste non exhaustive) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux (Angstöm, Debian, Ubuntu, &#8230;)</p>
</li>
<li>
<p>Android</p>
</li>
<li>
<p>QNX</p>
</li>
<li>
<p>FreeBSD</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_quelles_diff_rences_avec_la_raspberrypi">Quelles différences avec la RaspberryPi ?</h3>
<div class="paragraph">
<p>Les différences majeures portent sur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le CPU : de génération différente (ARMv7 vs ARMv6), la beaglebone est un cran au dessus (non négligeable pour exécuter du Java !).</p>
</li>
<li>
<p>la connectique : Cf. la liste ci-dessus, il n&#8217;y a pas photo ! La beaglebone est beaucoup plus complète.</p>
</li>
<li>
<p>le GPU : Capable de décoder des vidéos HD, la RaspberryPi est par contre meilleure dans ce domaine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour le reste, il y a eu plein d&#8217;articles comparatifs sur le web.
Celui sur le site <a href="http://makezine.com/magazine/how-to-choose-the-right-platform-raspberry-pi-or-beaglebone-black/">makezine.com</a> me paraît pas trop mal.</p>
</div>
<div class="paragraph">
<p>Pour résumer, la beaglebone est plus puissante que la Raspberry Pi sauf pour une utilisation multimédia.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_par_o_commencer">Par où commencer ?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_d_marrage">Démarrage</h3>
<div class="paragraph">
<p>Le démarrage est extrêmement simple.
En effet, la beaglebone est livrée avec une distribution Linux pré-installée (distribution <a href="http://www.angstrom-distribution.org/">Angstöm</a> orientée embarqué).
Pas besoin de préparer une carte SD comme avec la Raspberry Pi. Tout ce qu&#8217;il y a à faire, c&#8217;est de brancher l&#8217;alimentation !
Ecran/Clavier/Souris sont optionnels si vous utilisez une connexion réseau.</p>
</div>
<div class="sect3">
<h4 id="_alimentation_via_usb_5v">Alimentation via USB / 5V</h4>
<div class="paragraph">
<p>La BBB a besoin d&#8217;une alimentation en 5V. Pour faciliter le démarrage, vous n'êtes pas obligé d&#8217;avoir une alimentation externe.
Vous pouvez utiliser le cable USB fourni pour le brancher directement sur votre PC en utilisant le connecteur mini-USB coté BBB.
Dans ce cas, un disque partagé sera mis à disposition (USB Mass Storage) sur lequel vous trouverez la documentation et les éventuels drivers requis.
Si vous êtes, comme moi, sous Linux, vous n&#8217;aurez besoin d&#8217;aucun driver pout disposer de l&#8217;interface réseau "USB to LAN".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/bbb_usb_pc.jpg" alt="Accès SSH sur Beaglebone Black">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_services_disponibles">Services disponibles</h4>
<div class="paragraph">
<p>Si vous utilisez un cable ethernet, la BBB utilisera votre DHCP pour obtenir une adresse IP.
Si vous utilisez le cable USB fourni, vous aurez une interface réseau sur votre PC mise à disposition par la carte sur l&#8217;IP 192.168.7.1.
La BBB aura l&#8217;IP 192.168.7.2. Le login root a un mot de passe vide par défaut. Vous pouvez donc vous connecter par SSH très facilement.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/bbb_ssh.png" alt="Accès SSH sur Beaglebone Black">
</div>
</div>
<div class="paragraph">
<p>Un environnement de développement JavaScript (Cloud9) est également mis à disposition avec une version (un peu ancienne) de node.js.
La librairie <a href="https://github.com/jadonk/bonescript">BoneScript</a> fournie permet d&#8217;avoir une API "arduino like".
Ce service est disponible sur l&#8217;URL <a href="http://192.168.7.1:3000">http://192.168.7.1:3000</a> avec quelques exemples pour démarrer.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/blog/img/bbb_cloud9.jpg" alt="Cloud9 sur Beaglebone Black">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aller_plus_loin_et_changer_d_os">Aller plus loin &#8230; et changer d&#8217;OS</h3>
<div class="paragraph">
<p>Pour aller plus loin, vous aurez certainement envie de changer d&#8217;OS pour, par exemple,
installer <a href="http://elinux.org/BeagleBoardUbuntu">Ubuntu</a> et disposer d&#8217;un OS compatible avec le dernier build du <a href="https://jdk8.java.net/download.html">JDK8</a> (version "Hard Floating Point").</p>
</div>
</div>
</div>
</div></p>
                        <p><a href="/blog/2013/12/beaglebone-black-overview.html#disqus_thread">Commentaires</a></p>
  			<a href="/blog/2013/12/yet-another-blog.html"><h1>Yet another blog !</h1></a>
  			<p>01 décembre 2013</p>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://lhuet.github.io/blog/2013/12/yet-another-blog.html" data-text="Yet another blog !" data-via="lhuet35" data-lang="fr">Tweeter</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <div class="g-plusone" data-size="medium" data-href="http://lhuet.github.io/blog/2013/12/yet-another-blog.html"></div>

  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Cela faisait longtemps que je voulais créer ce blog. C&#8217;est maintenant chose faite !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_h_bergement">Hébergement</h3>
<div class="paragraph">
<p>Mon besoin principal (et oui, c&#8217;est un besoin !) est de partager diverses expériences à travers quelques billets.
Comme elles sont souvent liées à du code, rien de plus naturel que de mettre ces billets à coté de celui-ci sur GitHub !</p>
</div>
<div class="paragraph">
<p>Coté hébergement, mon choix s&#8217;est donc rapidement porté sur <a href="http://pages.github.com/">GitHub pages</a> &#8230; d&#8217;autant plus que ce service est gratuit !</p>
</div>
</div>
<div class="sect2">
<h3 id="_outils_de_publication">Outils de publication</h3>
<div class="paragraph">
<p><a href="http://jekyllrb.com/">Jekyll</a> est le choix naturel suggéré par la documentation GitHub.
N'étant pas fan de Ruby ni des gems à installer, j&#8217;ai longtemps hésité à franchir le pas.
Entre temps, j&#8217;ai beaucoup entendu parler (en bien) de <a href="http://asciidoctor.org">Asciidoctor</a>, notamment sur sa mise en place sur des projets
comme <a href="http://groovy.codehaus.org/">Groovy</a>, <a href="http://hibernate.org/">Hibernate</a>, ou <a href="http://golo-lang.org/">Golo</a>.
La migration du <a href="http://melix.github.io/blog/">blog de Cédric Champeau</a> m&#8217;a définitivement décidé à franchir le pas en me montrant la voie à suivre.</p>
</div>
<div class="paragraph">
<p>Ce blog est donc écrit en <a href="http://asciidoc.org/">AsciiDoc</a> et les pages statiques générées par <a href="http://jbake.org">JBake</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_venir">A venir</h3>
<div class="paragraph">
<p>Les billets à venir porteront sur Java &#8230; et le hardware &#8230; une fois que j&#8217;aurais bien appréhender l&#8217;AsciiDoc.</p>
</div>
<div class="paragraph">
<p>Stay tuned !</p>
</div>
<div class="paragraph">
<p>En bas de page, vous pourrez constater que les publications de ce site sont sous licence <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons by-nc-sa</a>.</p>
</div>
</div></p>
                        <p><a href="/blog/2013/12/yet-another-blog.html#disqus_thread">Commentaires</a></p>
	
	<hr />
	
	<p>Billets plus anciens disponibles sur la page <a href="/blog/archive.html">archive</a>.</p>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="text-muted credit">L'ensemble des posts de ce blog sont publiés sous licence <em>Creative Commons by-nc-sa</em>. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
        <p class="text-muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.0.2</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- script src="/blog/js/jquery-1.10.2.min.js"></script -->
    <!-- script src="/blog/js/bootstrap.min.js"></script -->
    <script src="/blog/js/run_prettify.js"></script>

    <script type="text/javascript">
        window.___gcfg = {lang: 'fr'};

        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46154958-1', 'lhuet.github.io');
      ga('send', 'pageview');

    </script>
    
  </body>
</html>